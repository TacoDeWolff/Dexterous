function api(b,c,d,a){if(!b){apiFatal("no API URL set")}else{$.ajax({type:(c==null?"GET":"POST"),url:b,data:c,dataType:"json",success:function(e){if(typeof e.error!=="undefined"){apiFatal(e.error.join("<br>"))}else{if(typeof d!=="undefined"&&d){applyTooltips();d(e)}}},error:function(e){if(typeof a!=="undefined"&&a){if(a(e)===false){return}}if(typeof e.responseJSON!=="undefined"&&typeof e.responseJSON["error"]!=="undefined"){apiFatal(e.responseJSON["error"].join("<br>"))}else{if(typeof e.responseText!=="undefined"){apiFatal(e.responseText)}else{if(typeof e.statusText!=="undefined"){apiFatal(e.statusText)}else{apiFatal(e)}}}}})}}function apiFatal(a){$("#api_error_link").fancybox({closeBtn:false,beforeShow:function(){this.skin.css({background:"#F2DEDE",color:"#B94A48",border:"solid 1px #EED3D7"})},overlay:{closeClick:true,locked:false}}).click()}function apiStatusClear(){$("#api_status div").stop(true).hide()}function apiStatusWorking(a){apiStatusClear();$("#api_status div.working").delay(800).fadeIn("fast");if(typeof a!=="undefined"){$("#api_status div.working span").delay(800).html(a).find("span[data-time]").attr("data-time",new Date().getTime())}}function apiStatusSuccess(a){apiStatusClear();$("#api_status div.success").fadeIn("fast");if(typeof a!=="undefined"){$("#api_status div.success span").html(a).find("span[data-time]").attr("data-time",new Date().getTime())}}function apiStatusError(a){apiStatusClear();$("#api_status div.error").fadeIn("fast");if(typeof a!=="undefined"){$("#api_status div.error span").html(a).find("span[data-time]").attr("data-time",new Date().getTime())}}function apiStatusTime(){$("span[data-time]").each(function(){var a=$(this),d=parseInt(a.attr("data-time"));if(!isNaN(d)){var c=Math.round((new Date().getTime()-d)/1000),e=new Date(d),b;if(c<10){b=""}else{if(c<30){b=" seconds ago"}else{if(c<60){b=" half a minute ago"}else{if(c<120){b=" 1 minute ago"}else{if(c<600){b=" "+Math.round(c/60)+" minutes ago"}else{b=" "+e.getHours()+":"+e.getMinutes()}}}}}if(a.text()!==b){a.fadeOut(function(){a.text(b)}).fadeIn()}}})}$(function(){setInterval(apiStatusTime,5000);apiStatusTime()});